## 阅读这篇文档

这篇文档是由如[Geocoding](#geocoding)或[Uploads](#uploads)这样一组相关功能的API和相关服务端点构成，每个服务端点是一个API中用于执行某个操作并位于特定URL的特定方法   

本文档中的每个服务端点使用如下几个部分描述:   

* HTTP方法: 包含GET, POST, PUT, PATCH和DELETE   
* 路径: 例如`/geocoding/v5/{mode}/{query}.json`   
* URL参数: 这些参数是服务端点路径中括号括起来的部分,
  像例子中的`{mode}`.
* 查询参数: 包含在一个有 _Option_ 请求头的表中, 并且这些参数被添加到请求的查询字符部分.
* 令牌作用域, 如果在需要一个令牌的情况下.  

所有文档中提到的URL有以下基本路径 
`https://api.mapbox.com`. 
这个基本路径在服务端点路径之前. 在这个例子中，你需要把 `https://api.mapbox.com`和 `/geocoding/v5/{mode}/{query}.json`组合得到请求的URL `https://api.mapbox.com/geocoding/v5/{mode}/{query}.json`.

在这个服务端点中, `{mode}`和 `{query}`是URL参数. 在一个请求中，你将用真实值去替换对应的占位符: 例如，你应该选择 `mapbox.places`作为你的模式, `Chester`作为你要查询的目标, 并得到这样的URL `https://api.mapbox.com/geocoding/v5/mapbox.places/Chester.json`  

查询参数是用[查询字符串编码](https://en.wikipedia.org/wiki/Query_string)来添加到URL的结尾.如果你想把 `country` 这个请求参数添加到这个Geocoding请求中，你应该把查询字符串 `?country=us`加到URL的结尾, 得到`https://api.mapbox.com/geocoding/v5/mapbox.places/Chester.json?country=us`.  

所有的服务端点需要一个访问令牌, 这个令牌是作为一个查询参数被提供的.   
所以最终你要构造的geocoding请求会是这样`https://api.mapbox.com/geocoding/v5/mapbox.places/Chester.json?country=us&access_token=pk.my-token-value`.
下一章节包括你将如何获得和使用访问令牌.

```http
https://api.mapbox.com
```

## 访问令牌

访问Mapbox的web服务需要一个[访问令牌](https://mapbox.com/help/define-access-token), 这个访问令牌会连接API请求到你的账户. 本文档中的示例请求不包括访问令牌: 你需要使用`access_token`查询选项来提供一个或者在SDK或者库中指定一个令牌.

在你的[账户面板](https://www.mapbox.com/account)中可以得到默认访问令牌. 你也可以在你的[访问令牌页](https://www.mapbox.com/account/access-tokens/)或者使用[Tokens API](#tokens)管理和创建附加的令牌.

#### 访问令牌用例

```http
https://api.mapbox.com/{endpoint}?access_token={your_access_token}
```

当创建一个新的访问令牌时, 您可以选择添加一个或多个**作用域**. 
每个作用域为令牌添加了不同的权限来用于
访问受限API. 在整个文档中, 我们指定了访问每个服务端点所必需的作用域.

## Versioning

Each Mapbox API is versioned with a version string specified in the base URL that
can be incremented independently from other APIs.

#### Versioning example

```http
https://api.mapbox.com/{api}/{version}
```

_The [Maps API](#maps) is an exception: its endpoint is prefixed
with `/v4/{map_id}` instead of putting the version after the API name.
This mismatch will be fixed in the next API version._

Using the newest available API is always encouraged.

These changes are considered backwards compatible and will
not require the version string to be incremented:

- Adding properties to JSON objects.
- Changing the number of items returned in a single listing request.
- Changing rate limiting thresholds.
- The structure or length of identifiers generated by the API.
- Changing error messages.

These changes are considered backwards incompatible and will require
the version string to be incremented:

- Removing properties from JSON objects.
- Changing an API's URL structure

In the event that certain functionality is deprecated, we will give at least
90 days notice via email. You will only receive a deprecation email if we
detect you are using part of the API that is being deprecated.

## Rate limits

Mapbox APIs have rate limits that cap the number of requests
that can be made against an endpoint. If you exceed a rate limit, your
request will be throttled and you will receive `HTTP 429 Too Many Requests`
responses from the API.

| Header | Description |
| --- | --- |
| `X-Rate-Limit-Interval` | Length of rate-limiting interval in seconds. |
| `X-Rate-Limit-Limit` | Maximum number of requests you may make in the current interval before reaching the limit. |
| `X-Rate-Limit-Reset` | Unix timestamp of when the current interval will end and the ratelimit counter is reset.|

## CORS

Mapbox web services support [Cross-Origin
Requests](https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS) with no domain restrictions.
To support Internet Explorer 8 and 9, use a library that falls back to
XDomainRequest, like [corslite](https://github.com/mapbox/corslite/).

## Retina

```http
# a 400x200 static map
https://api.mapbox.com/v4/mapbox.dark/-76.9,38.9,5/400x200.png?access_token={your_access_token}

# the same static map for Retina
# displays: this image will be 800x400
# pixels, but show the same content
# and look the same when scaled down
https://api.mapbox.com/v4/mapbox.dark/-76.9,38.9,5/400x200@2x.png?access_token={your_access_token}
```

Mapbox supports Retina image output on all APIs that serve images.
Add `@2x` before the file extension on a URL to request an image at
double scale. For instance, a map tile that is 256×256 pixels will be
512×512 pixels with `@2x`, but show the same content. When displayed
on a page, the image will be still sized to 256×256 pixels, but
4 pixels of the original will represent 1 pixel in screen units.

The `@2x` part of the URL goes before the entire format, so a URL
that ends in `.png` would end with `@2x.png` as a Retina image.

The only assets that are not available at Retina scale are tilesets
uploaded from TileMill or as MBTiles.

## HTTPS

We recommend all access to Mapbox is over HTTPS. Except for the
Maps API, requests initiated over HTTP are automatically upgraded to HTTPS.

## Pagination

```curl
Link: <https://api.mapbox.com/uploads/v1/1454024795582?start=cijywvxlm004rtikohhqf99jv&limit=100>; rel="next"
```

Pagination lets you list many objects from an API by using more than one
request. After receiving a page of objects, the next page can be requested using
the `next` link relation in [`Link` header](http://tools.ietf.org/html/rfc5988)
of the response. This process can be repeated until the server sends a response
without a `Link` header or without a `next` link relation, which signals the end
of the collection.

Your application *must* use the `Link` header for pagination instead of
constructing your own URLs as the specific URLs used for pagination may change
at any time. The
[Python requests library](http://docs.python-requests.org/en/master/user/advanced/#link-headers),
and the
[link-header-parser module for JavaScript](https://github.com/thlorenz/parse-link-header)
can parse Link headers. Link headers follow the [RFC 5988 specifications](http://tools.ietf.org/html/rfc5988).

Pagination is supported on the [Datasets](#datasets), [Uploads](#uploads), [Styles](#styles), [Tilesets](#tilesets), and [Tokens](#tokens) list endpoints.

| Query Parameter | Description |
| --- | --- |
| `limit` | The *maximum* number of objects to return. The API will attempt to return the requested number of objects, but receiving fewer objects does not necessarily signal the end of the collection. Receiving a response with no `Link` header or no `next` link relation is the only way to determine when you are at the end of a collection. |

## Dates

Most dates and times returned by the API are represented
in [RFC 3339](https://tools.ietf.org/html/rfc3339) format, which can be
parsed by the [JavaScript Date](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date)
constructor, the [Python arrow library](https://github.com/crsmithdev/arrow),
and many other libraries and languages.

```javascript
var parsedDate = new Date('2014-11-21T19:41:10.000Z');
```

```python
import arrow
arrow.get('2014-11-21T19:41:10.000Z')
<Arrow [2014-11-21T19:41:10+00:00]>
```

```objc
@import Foundation;

NSDateFormatter *RFC3339DateFormatter = [[NSDateFormatter alloc] init];
RFC3339DateFormatter.locale = [NSLocale localeWithLocaleIdentifier:@"en_US_POSIX"];
RFC3339DateFormatter.dateFormat = @"yyyy-MM-dd'T'HH:mm:ssZZZZZ";
RFC3339DateFormatter.timeZone = [NSTimeZone timeZoneForSecondsFromGMT:0];

NSDate *date = [RFC3339DateFormatter dateFromString:@"2014-11-21T19:41:10.000Z"];
```

```swift
import Foundation

let rfc3339DateFormatter = DateFormatter()
rfc3339DateFormatter.locale = Locale(identifier: "en_US_POSIX")
rfc3339DateFormatter.dateFormat = "yyyy-MM-dd'T'HH:mm:ssZZZZZ"
rfc3339DateFormatter.timeZone = TimeZone(secondsFromGMT: 0)

let date = rfc3339DateFormatter.date(from: "2014-11-21T19:41:10.000Z")
```

The only exception to this rule is the [Retrieve TileJSON metadata](#retrieve-tilejson-metadata)
endpoint that returns `created` and `modified` properties as [Unix time](https://en.wikipedia.org/wiki/Unix_time).

```objc
@import Foundation;

NSDate *date = [NSDate dateWithTimeIntervalSince1970:1416598870000];
```

```swift
import Foundation

let date = Date(timeIntervalSince1970: 1_416_598_870_000)
```

## Coordinates

Where geographic coordinates are provided to a Mapbox API, they should be formatted
in the order `longitude, latitude` and specified as decimal degrees in the WGS84
coordinate system. This pattern matches existing standards, including GeoJSON and KML.

Mapbox APIs use GeoJSON formatting wherever possible to represent
geospatial data. The Directions, Map Matching, Geocoding, and Datasets APIs
all return GeoJSON-formatted responses, and the Upload and Map Matching APIs
accept GeoJSON input.

The only exception to `longitude, latitude` ordering is the polyline format, supported
in Static (Classic) overlays and Directions responses. When polyline input
or output is specified, the polyline content should follow the Google Encoded Polyline format,
which specifies `latitude, longitude` ordering.

The Mapbox Swift libraries use the Core Location framework’s
[`CLLocationCoordinate2D`](https://developer.apple.com/reference/corelocation/cllocationcoordinate2d)
type to represent geographic coordinates. When initializing a
`CLLocationCoordinate2D`, always specify the latitude before the longitude.

```objc
@import CoreLocation;

CLLocationCoordinate2D coord = CLLocationCoordinate2DMake(38.9099711, -77.0361122);
```

```swift
import CoreLocation

let coord = CLLocationCoordinate2D(latitude: 38.9099711, longitude: -77.0361122)
```
